{% extends "base.twig" %}

{% block title %}Dashboard - TicketApp{% endblock %}

{% set current_route = '/app/dashboard' %}

{% block content %}
<div class="min-h-screen bg-brand-dark flex items-center justify-center px-6 text-white">
    <!-- Dashboard card centered -->
    <div class="max-w-md w-full bg-card-dark border border-brand-blue rounded-xl shadow-[0_30px_80px_rgba(80,80,255,0.2)] p-6">
        <!-- Header row with user + logout -->
        <div class="flex items-start justify-between">
            <div>
                <h1 class="text-xl font-semibold text-white">Dashboard</h1>
                <p class="text-xs text-gray-400 mt-1">
                    Signed in as
                    <span class="text-brand-blue">{{ user_email }}</span>
                </p>
            </div>

            <a href="/auth/logout"
               class="text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg px-3 py-2">
                Logout
            </a>
        </div>

        <!-- LIVE STATS -->
        <div class="mt-6 grid grid-cols-3 gap-3 text-center text-xs">
            <!-- Total tickets -->
            <div class="bg-input-dark rounded-lg p-3 border border-gray-600">
                <div class="text-white font-semibold text-lg">
                    {{ stats.total }}
                </div>
                <div class="text-gray-400">Total</div>
            </div>

            <!-- Open tickets -->
            <div class="bg-input-dark rounded-lg p-3 border border-gray-600">
                <div class="text-green-400 font-semibold text-lg">
                    {{ stats.open }}
                </div>
                <div class="text-gray-400">Open</div>
            </div>

            <!-- Closed tickets -->
            <div class="bg-input-dark rounded-lg p-3 border border-gray-600">
                <div class="text-gray-300 font-semibold text-lg">
                    {{ stats.closed }}
                </div>
                <div class="text-gray-400">Closed</div>
            </div>
        </div>

        <!-- In Progress tickets (if any) -->
        {% if stats.in_progress > 0 %}
        <div class="mt-3 text-center">
            <div class="bg-input-dark rounded-lg p-3 border border-gray-600 inline-block">
                <div class="text-amber-400 font-semibold text-lg">
                    {{ stats.in_progress }}
                </div>
                <div class="text-gray-400 text-xs">In Progress</div>
            </div>
        </div>
        {% endif %}

        <!-- NAVIGATION HINT -->
        <div class="mt-8 text-[11px] text-gray-500 leading-relaxed text-center">
            <p>
                These stats are calculated from your actual tickets saved in the database.
                Create or close tickets on the
                <a href="/app/tickets" class="text-brand-blue hover:text-[rgb(100,100,255)] underline underline-offset-2">
                    Tickets page
                </a>.
            </p>
        </div>

        <!-- Quick actions -->
        <div class="mt-6 flex flex-col gap-2">
            <a href="/app/tickets" 
               class="w-full bg-brand-blue bg-brand-blue-hover text-white font-medium rounded-lg px-4 py-2 text-center text-sm shadow-brand-blue">
                Manage Tickets
            </a>
            
            <a href="/app/tickets" 
               class="w-full bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg px-4 py-2 text-center text-sm">
                Create New Ticket
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh stats every 30 seconds
setInterval(function() {
    // In a real app, you'd fetch updated stats via AJAX
    // For now, we just refresh the page if user is idle
    if (document.hidden === false) {
        // Could implement AJAX refresh here
    }
}, 30000);

// Store user email for client-side use
localStorage.setItem('ticketapp_user_email', '{{ user_email }}');
</script>
{% endblock %}